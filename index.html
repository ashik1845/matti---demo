<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eventhub</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playwrite+CU+Guides&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <style>
        body {
        font-family: Arial, sans-serif;
        background: #f4f4f4;
        padding: 40px;
      }
      .container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
      }
      .card {
        width: 320px;
        background: white;
        margin: 20px;
        box-shadow: 0 0 15px #ccc;
        border-radius: 10px;
        transition: 0.3s;
        cursor: pointer;
        position: relative;
      }
      .card:hover {
        transform: scale(1.05);
      }
      img {
        width: 100%;
        height: 200px;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
      }
      .content {
        padding: 20px;
      }
      h2 {
        font-size: 20px;
        color: #444;
      }
      p {
        font-size: 14px;
        color: #777;
      }
      a,
      button {
        display: inline-block;
        text-decoration: none;
        color: #fff;
        background: #28a745;
        padding: 10px 20px;
        margin: 10px 0;
        border-radius: 5px;
        transition: 0.3s;
      }
      a:hover,
      button:hover {
        background: #218838;
      }
      .badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background: red;
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 14px;
      }
      .remove-btn {
        background: red;
      }
      .remove-btn:hover {
        background: darkred;
      }
       .banner-container {
        width: 100%;
        height: 50vh; /* Fixed height, but responsive */
        max-height: 900px; /* Limits height on larger screens */
        display: flex;
        justify-content: center;
        align-items: center;
        /* Prevents white gaps */
        overflow: hidden;
    }

    .banner-img {
        width: 100%;
        height: 100%;
        object-fit: cover; /* Ensures the image scales inside the container */
    }

    @media (max-width: 768px) {
        .banner-container {
            height: 35vh; /* Adjust the height for mobile */
            max-height: 250px;
        }
    }
        .category-icon {
            width: 80px;
            height: 80px;
            background: #f8f9fa;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: auto;
        }
        .card {
            transition: transform 0.3s ease-in-out;
        }
        .card:hover {
            transform: scale(1.05);
        }
        @media (max-width: 768px) {
            .navbar-nav {
                text-align: center;
            }
        }
        footer{
            margin-top: 10px;
        }
        
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">Eventhub</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <input type="text" class="form-control" placeholder="Search events">
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="event.html">Create Event</a></li>
                    <li class="nav-item"><a class="nav-link" href="login.html">Login/Sign Up</a></li>
                    <button id="nearbyEventsBtn">Nearby Events</button>
<div id="nearbyEvents"></div>

                </ul>
            </div>
        </div>
    </nav>

    <!-- Carousel -->
    <div class="banner-container">
        <div id="bannerCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img src="/assets/1.webp" class="d-block w-100 banner-img" alt="Event 1">
                </div>
                <div class="carousel-item">
                    <img src="/assets/2.webp" class="d-block w-100 banner-img" alt="Event 2">
                </div>
                <div class="carousel-item">
                    <img src="/assets/3.webp" class="d-block w-100 banner-img" alt="Event 3">
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#bannerCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#bannerCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
            </button>
        </div>
    </div>

    <!-- Event Categories -->
    <div class="container text-center my-4">
        <div class="row">
            <div class="col-4 col-md-2"><div class="category-icon">üéµ</div><p>Music</p></div>
            <div class="col-4 col-md-2"><div class="category-icon">üé≠</div><p>Culturals</p></div>
            <div class="col-4 col-md-2"><div class="category-icon">üé®</div><p>Art</p></div>
            <div class="col-4 col-md-2"><div class="category-icon">‚öΩ</div><p>Sports</p></div>
            <div class="col-4 col-md-2"><div class="category-icon">üé§</div><p>Talks</p></div>
            <div class="col-4 col-md-2"><div class="category-icon">üë©üèª‚Äçüíª</div><p>Tech</p></div>
        </div>
    </div>

    <!-- Featured Events -->
    <div class="container" id="eventList"></div>

    <script>
      const eventList = document.getElementById("eventList");
      let events = JSON.parse(localStorage.getItem("events")) || [];

      function renderEvents() {
        eventList.innerHTML = "";
        const today = new Date().toISOString().split("T")[0];

        events = events.filter(
          (event) => new Date(event.date).toISOString().split("T")[0] >= today
        );

        localStorage.setItem("events", JSON.stringify(events));

        events.forEach((event, index) => {
          const eventDate = new Date(event.date).toISOString().split("T")[0];
          const regCloseDate = new Date(event.regCloseDate)
            .toISOString()
            .split("T")[0];

          const isRegistrationClosed = regCloseDate < today;
          const isExpired = eventDate < today;

          const eventCard = document.createElement("div");
          eventCard.className = "card";
          eventCard.onclick = () => {
            localStorage.setItem("currentEventIndex", index);
            window.location.href = "view.html";
          };

          eventCard.innerHTML = `
        <img src="${event.image}" alt="${event.name}">
        <div class="content">
          <h2>${event.name}</h2>
          <p>${event.description}</p>
          <p>Event Date: ${eventDate}</p>
          <p>Closing Date: ${regCloseDate}</p>
          <p>Amount: ‚Çπ${event.amount}</p>
          <a href="${event.formLink}" target="_blank">View Details</a>
          
        </div>
      `;

          if (isRegistrationClosed) {
            const badge = document.createElement("div");
            badge.className = "badge";
            badge.textContent = "Registration Closed";
            eventCard.appendChild(badge);
          }

          eventList.appendChild(eventCard);
        });
      }

      function removeEvent(index) {
        events.splice(index, 1);
        localStorage.setItem("events", JSON.stringify(events));
        renderEvents();
      }

      renderEvents();
    </script>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-3">
        &copy; 2025 EventFinder. All rights reserved.
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const carousel = new bootstrap.Carousel(document.querySelector("#eventCarousel"), {
                interval: 3000,
                wrap: true
            });
        });
        
    </script>

<script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-analytics.js"></script>
    <!-- Firebase SDK -->
<script type="module">
    // Import Firebase
   // Import the functions you need from the SDKs you need

// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional


const firebaseConfig = {
  apiKey: "AIzaSyBrN8SZQMdGsbCcupoBv-P02fIjKcCkIz0",
  authDomain: "event-cf7cb.firebaseapp.com",
  projectId: "event-cf7cb",
  storageBucket: "event-cf7cb.firebasestorage.app",
  messagingSenderId: "265870086420",
  appId: "1:265870086420:web:f4bb5835f1a54e1cf3b201",
  measurementId: "G-95EZGQM9QS"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const analytics = getAnalytics(app);
    // Function to Get User Location and Fetch Nearby Events
    document.getElementById("nearbyEventsBtn").addEventListener("click", () => {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const userLat = position.coords.latitude;
                    const userLng = position.coords.longitude;

                    console.log("User Location:", userLat, userLng);
                    fetchNearbyEvents(userLat, userLng);
                },
                (error) => {
                    console.error("Error getting location:", error);
                }
            );
        } else {
            alert("Geolocation is not supported by this browser.");
        }
    });

    // Function to Fetch Events from Firestore
    function fetchNearbyEvents(userLat, userLng) {
        db.collection("events").get().then((querySnapshot) => {
            let nearbyEvents = [];
            querySnapshot.forEach((doc) => {
                const eventData = doc.data();
                const eventGeoPoint = eventData.Location;

                if (eventGeoPoint) {
                    const eventLat = eventGeoPoint.latitude;
                    const eventLng = eventGeoPoint.longitude;

                    // Check if event is within 10km radius
                    if (getDistance(userLat, userLng, eventLat, eventLng) <= 10) {
                        nearbyEvents.push({
                            id: doc.id,
                            name: eventData.name,
                            description: eventData.description,
                            amount: eventData.amount,
                            eventDate: eventData["event date"].toDate(),
                            registrationClosing: eventData["registration closing date"].toDate(),
                            totalTickets: eventData["total tickets"]
                        });
                    }
                }
            });

            // Display Nearby Events
            displayNearbyEvents(nearbyEvents);
        }).catch((error) => {
            console.error("Error fetching events:", error);
        });
    }

    // Function to Calculate Distance Between Two Coordinates (Haversine Formula)
    function getDistance(lat1, lon1, lat2, lon2) {
        const R = 6371; // Radius of Earth in km
        const dLat = (lat2 - lat1) * (Math.PI / 180);
        const dLon = (lon2 - lon1) * (Math.PI / 180);
        const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                  Math.cos(lat1 * (Math.PI / 180)) * Math.cos(lat2 * (Math.PI / 180)) *
                  Math.sin(dLon / 2) * Math.sin(dLon / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return R * c; // Distance in km
    }

    // Function to Display Nearby Events
    function displayNearbyEvents(events) {
        const nearbyEventsDiv = document.getElementById("nearbyEvents");
        nearbyEventsDiv.innerHTML = "";

        if (events.length === 0) {
            nearbyEventsDiv.innerHTML = "<p>No nearby events found.</p>";
            return;
        }

        events.forEach((event) => {
            const eventCard = `
                <div class="card m-2" style="width: 18rem;">
                    <div class="card-body">
                        <h5 class="card-title">${event.name}</h5>
                        <p class="card-text">${event.description}</p>
                        <p><strong>Amount:</strong> ${event.amount}</p>
                        <p><strong>Event Date:</strong> ${event.eventDate.toLocaleString()}</p>
                        <p><strong>Registration Closes:</strong> ${event.registrationClosing.toLocaleString()}</p>
                        <p><strong>Total Tickets:</strong> ${event.totalTickets}</p>
                    </div>
                </div>
            `;
            nearbyEventsDiv.innerHTML += eventCard;
        });
    }
</script>

  
</body>
</html>